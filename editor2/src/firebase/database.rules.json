// firebase pre-processes database rules to allow comments in json
{
  "rules": {
    ".read": true,
    ".write": false,
    "presence": {
      "$doc": {
        "$user": {
          "$timestamp": {
            // writeable by user only
            ".write": "$user === auth.uid",
            // $timestamp is a number, value is true or nil (.validate ignores nil)
            ".validate": "$timestamp.matches(/^[0-9]+$/) && newData.val() === true"
          }
        }
      }
    },
    "profile": {
      "$user": {
        // only user can write their profile
        ".write": "$user === auth.uid",
        // profile is an object which can only contain avatar (image url) & displayName (string)
        ".validate": "newData.hasChildren(['avatar', 'displayName']) && newData.child('avatar').isString() && newData.child('displayName').isString()"
      }
    }
  }
}